---
// PostHog Analytics component
// Add this to your layout to enable analytics tracking
---

<script>
  import posthog from 'posthog-js';

  // Initialize PostHog only in production or if explicitly enabled
  const POSTHOG_KEY = import.meta.env.PUBLIC_POSTHOG_KEY;
  const POSTHOG_HOST = import.meta.env.PUBLIC_POSTHOG_HOST || 'https://us.i.posthog.com';

  if (POSTHOG_KEY) {
    posthog.init(POSTHOG_KEY, {
      api_host: POSTHOG_HOST,
      person_profiles: 'identified_only',
      capture_pageview: false, // We'll manually capture for SPA navigation
      capture_pageleave: true,
      autocapture: true,
    });

    // Capture initial pageview
    posthog.capture('$pageview');

    // Handle Astro View Transitions (SPA-like navigation)
    document.addEventListener('astro:page-load', () => {
      posthog.capture('$pageview');
    });

    // Make posthog available globally for custom events
    (window as any).posthog = posthog;
  }
</script>
