---
import ThemeControl from './ThemeControl.astro';
---

<nav class="navbar fixed top-0 left-0 right-0 z-50  duration-300 ease-out">
  <div class="navbar-container max-w-6xl mx-auto px-6">
    <div class="navbar-content flex items-center justify-between  duration-300 ease-out">
      <!-- Logo -->
      <a href="/" class="logo-link group">
        <div class="flex items-center space-x-2">
          <div class="logo-box">
            <span class="logo-text">A</span>
          </div>
          <span class="font-bold text-main group-hover:text-main/70">
            Allison
          </span>
        </div>
      </a>

      <!-- Navigation Links -->
      <div class="hidden md:flex items-center space-x-8">
        <a href="/projects" class="nav-link">
          <span>Proyectos</span>
          <div class="nav-underline"></div>
        </a>
        <a href="/_blog" class="nav-link">
          <span>Blog</span>
          <div class="nav-underline"></div>
        </a>
        <a href="/about" class="nav-link">
          <span>Sobre mí</span>
          <div class="nav-underline"></div>
        </a>
        <a href="/contact" class="nav-link">
          <span>Contacto</span>
          <div class="nav-underline"></div>
        </a>
      </div>

      <!-- Theme Toggle & Mobile Menu -->
      <div class="flex items-center space-x-4">
        <ThemeControl />
        <button class="md:hidden mobile-menu-btn" aria-label="Menu">
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div class="md:hidden mobile-menu">
      <div class="py-4 space-y-2">
        <a href="/projects" class="mobile-link">Proyectos</a>
        <a href="/_blog" class="mobile-link">Blog</a>
        <a href="/about" class="mobile-link">Sobre mí</a>
        <a href="/contact" class="mobile-link">Contacto</a>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Navbar States */
  .navbar {
    background: var(--color-secondary);
    border: 4px solid var(--color-main);
    box-shadow: 
      0 8px 0px var(--color-main),
      0 0 0 0 var(--color-main);
    transform: translateY(0);
  }

  .navbar.scrolled {
    background: var(--color-secondary);
    backdrop-filter: blur(10px);
    border-width: 2px;
    box-shadow: 
      0 4px 0px var(--color-main),
      0 0 20px 0 var(--color-main);
  }

  .navbar.hidden {
    transform: translateY(-100%);
  }

  .navbar-content {
    height: 4rem;
  }

  .navbar.scrolled .navbar-content {
    height: 3rem;
  }

  /* Logo Animation */
  .logo-box {
    @apply relative border-2 border-main flex items-center justify-center;
    width: 2.5rem;
    height: 2.5rem;
    background: var(--color-main);

    overflow: hidden;
  }

  .navbar.scrolled .logo-box {
    width: 2rem;
    height: 2rem;
  }



  .logo-text {
    @apply font-bold text-main relative z-10;
    font-size: 1.25rem;
 
  }

  .navbar.scrolled .logo-text {
    font-size: 1rem;
  }


  /* Navigation Links */
  .nav-link {
    @apply relative text-main/70 hover:text-main font-medium;
    position: relative;
    display: inline-block;
    font-size: 1rem;
 
  }

  .navbar.scrolled .nav-link {
    font-size: 0.875rem;
  }

  .nav-underline {
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--color-main);
 
  }

  .nav-link:hover .nav-underline {
    width: 100%;
  }

  /* Active page indicator */
  .nav-link.active {
    color: var(--color-main);
  }

  .nav-link.active .nav-underline {
    width: 100%;
  }

  /* Mobile Menu */
  .mobile-menu {
    max-height: 0;
    overflow: hidden;
 
  }

  .mobile-menu.open {
    max-height: 200px;
  }

  .mobile-link {
    @apply block px-4 py-2 text-main hover:text-main;
  }

  /* Hamburger Menu */
  .hamburger {
    @apply relative w-6 h-5 cursor-pointer;
  }

  .hamburger span {
    @apply absolute block w-full h-0.5 bg-main rounded  duration-300;
  }

  .hamburger span:nth-child(1) { top: 0; }
  .hamburger span:nth-child(2) { top: 50%; transform: translateY(-50%); }
  .hamburger span:nth-child(3) { bottom: 0; }

  .mobile-menu-btn.active .hamburger span:nth-child(1) {
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
  }

  .mobile-menu-btn.active .hamburger span:nth-child(2) {
    opacity: 0;
  }

  .mobile-menu-btn.active .hamburger span:nth-child(3) {
    bottom: 50%;
    transform: translateY(50%) rotate(-45deg);
  }

</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.querySelector('.navbar');
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    let lastScrollY = window.scrollY;
    let ticking = false;

    // Scroll behavior
    function updateNavbar() {
      const scrollY = window.scrollY;
      
      if (scrollY > 50) {
        navbar?.classList.add('scrolled');
      } else {
        navbar?.classList.remove('scrolled');
      }

      // Hide/show on scroll direction
      if (scrollY > 100) {
        if (scrollY > lastScrollY) {
          // Scrolling down
          navbar?.classList.add('hidden');
        } else {
          // Scrolling up
          navbar?.classList.remove('hidden');
        }
      } else {
        navbar?.classList.remove('hidden');
      }

      lastScrollY = scrollY;
      ticking = false;
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateNavbar);
        ticking = true;
      }
    }

    window.addEventListener('scroll', requestTick, { passive: true });

    // Mobile menu
    mobileMenuBtn?.addEventListener('click', () => {
      mobileMenuBtn.classList.toggle('active');
      mobileMenu?.classList.toggle('open');
    });

    // Set active page
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href === currentPath || (currentPath.startsWith(href) && href !== '/')) {
        link.classList.add('active');
      }
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('nav')) {
        mobileMenuBtn?.classList.remove('active');
        mobileMenu?.classList.remove('open');
      }
    });
  });
</script>