---
import ScrollProgress from './ScrollProgress';
import Sidebar from './Sidebar.astro';
import { defaultLang, type Language } from '@/i18n/ui';

interface Props {
    contentId?: string;
    sidebarClassName?: string;
    containerClassName?: string;
    contentClassName?: string;
    lang?: Language;
    useClerkTOC?: boolean;
}

const {
    contentId = 'main-content',
    sidebarClassName = '',
    containerClassName = '',
    contentClassName = '',
    lang = defaultLang,
    useClerkTOC = true,
} = Astro.props as Props;
---

<!-- Scroll Progress (global component) -->
<ScrollProgress client:idle />

<!-- Full height layout with content and sidebar -->
<div class={`flex ${containerClassName}`} id={`${contentId}-container`}>
    <!-- Main content area -->
    <main
        class={`mx-auto min-w-0 w-fit max-w-[850px] ${contentClassName}`}
        id={contentId}
        data-heading-slug-root
    >
        <slot />
    </main>

    <!-- Desktop Sidebar -->
    <Sidebar
        contentId={contentId}
        className={sidebarClassName}
        lang={lang}
        useClerkTOC={useClerkTOC}
    />
</div>

<script is:inline type="module" define:vars={{ contentId }}>
    import { initializeHeadingSlugs } from '@/utils/heading-slugs.ts';

    initializeHeadingSlugs(contentId);
</script>
