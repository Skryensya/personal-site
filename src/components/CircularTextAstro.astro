---
interface Props {
  text: string;
  spinDuration?: number;
  onHover?: 'slowDown' | 'speedUp' | 'pause' | 'goBonkers';
  className?: string;
}

const {
  text,
  spinDuration = 20,
  onHover = 'speedUp',
  className = ''
} = Astro.props;

const letters = Array.from(text);
const componentId = `circular-text-${Math.random().toString(36).substring(2, 9)}`;
---

<div 
  id={componentId}
  class={`circular-text-container m-0 mx-auto rounded-full w-[150px] h-[150px] relative font-black text-secondary text-center cursor-pointer origin-center ${className}`}
  data-spin-duration={spinDuration}
  data-on-hover={onHover}
>
  {letters.map((letter, i) => {
    const rotationDeg = (360 / letters.length) * i;
    const factor = Math.PI / letters.length;
    const x = factor * i;
    const y = factor * i;
    const transform = `rotateZ(${rotationDeg}deg) translate3d(${x}px, ${y}px, 0)`;

    return (
      <span
        class="circular-letter absolute inline-block inset-0 text-2xl"
        style={`transform: ${transform}; -webkit-transform: ${transform};`}
      >
        {letter}
      </span>
    );
  })}
</div>

<style>
  .circular-text-container {
    animation: spin var(--spin-duration, 20s) linear infinite;
    transition: transform 150ms ease-out, scale 150ms ease-out;
  }

  .circular-letter {
    transition: all 500ms cubic-bezier(0, 0, 0, 1);
  }

  /* Hover effects */
  .circular-text-container[data-on-hover="speedUp"]:hover {
    animation-duration: calc(var(--spin-duration, 20s) / 4);
  }

  .circular-text-container[data-on-hover="slowDown"]:hover {
    animation-duration: calc(var(--spin-duration, 20s) * 2);
  }

  .circular-text-container[data-on-hover="pause"]:hover {
    animation-play-state: paused;
  }

  .circular-text-container[data-on-hover="goBonkers"]:hover {
    animation-duration: calc(var(--spin-duration, 20s) / 20);
    transform: scale(0.8);
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>

<script define:vars={{ componentId, spinDuration, onHover }}>
  document.addEventListener('astro:page-load', () => {
    const container = document.getElementById(componentId);
    if (!container) return;
    
    // Set CSS custom property for animation duration
    container.style.setProperty('--spin-duration', `${spinDuration}s`);
  });
</script>