---
import ProjectCard from '../ProjectCard.astro';
import ProjectCarousel from '../ProjectCarousel.astro';
import { getFeaturedProjectsByLanguage, getSlugFromId } from '@/utils/content-utils';
import { getTranslations } from '@/i18n/utils';
import { defaultLang, type Language } from '@/i18n/ui';
import { getLocalizedUrl } from '@/utils/localized-routes';

interface Props {
    lang?: Language;
}

const { lang = defaultLang } = Astro.props;
const t = getTranslations(lang);

// Get all featured projects in the current language
const featuredProjects = (await getFeaturedProjectsByLanguage(lang))
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());
---

<section id={lang === 'es' ? 'proyectos' : (lang === 'no' ? 'prosjekter' : 'projects')} class="py-20 bg-secondary">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="font-mono text-3xl font-bold text-main mb-12">{t('home.featuredProjects')}</h2>
    <ProjectCarousel projectCount={featuredProjects.length}>
      {featuredProjects.map((project, index) => (
        <ProjectCard
          name={project.data.name}
          hook={project.data.hook}
          href={getLocalizedUrl(lang, 'projects', getSlugFromId(project.id))}
          slug={getSlugFromId(project.id)}
          dataIndex={index + 1}
          tags={project.data.tags}
          publishDate={project.data.publishDate.toISOString()}
          lang={lang}
        />
      ))}
    </ProjectCarousel>
  </div>
</section>