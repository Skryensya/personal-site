---
import { getCollection } from 'astro:content';
import ProjectCardReact from './ProjectCardReact';
import { PointerTypeProvider } from '../contexts/PointerTypeProvider';
import { getFeaturedProjectsByLanguage, getSlugFromId } from '@/utils/content-utils';
import { useTranslations } from '@/i18n/utils';
import { defaultLang, type Language } from '@/i18n/ui';
import { getLocalizedUrl } from '@/utils/localized-routes';

interface Props {
    lang?: Language;
}

const { lang = defaultLang } = Astro.props;
const t = useTranslations(lang);

// Get first 4 featured projects in the current language
const featuredProjects = (await getFeaturedProjectsByLanguage(lang))
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 4);
---

<section class="py-20 bg-secondary">
  <div class="max-w-7xl mx-auto">
    <h2 class="font-mono text-3xl font-bold text-main mb-12">{t('home.featuredProjects')}</h2>
    
    <PointerTypeProvider client:load>
      <div class="flex items-center justify-start gap-4 flex-wrap" >
        {featuredProjects.map((project, index) => (
          <ProjectCardReact
            client:load
            title={project.data.title}
            description={project.data.description}
            href={getLocalizedUrl(lang, 'projects', getSlugFromId(project.id))}
            slug={getSlugFromId(project.id)}
            dataIndex={index + 1}
          />
        ))}
      </div>
    </PointerTypeProvider>
    
    <div class="text-center mt-12">
      <a 
        href={getLocalizedUrl(lang, 'projects')}
        class="inline-block bg-main text-secondary px-6 py-3 font-mono text-sm font-bold border border-main hover:bg-secondary hover:text-main"
      >
        {t('nav.projects')}
      </a>
    </div>
  </div>
</section>